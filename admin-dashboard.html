<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Kapruka</title>
  <link rel="icon" type="image/png" href="https://play-lh.googleusercontent.com/XPaIW4RsTkd8au1rBlcwAtdyynz9pZyPVn3QPK4gXbboroWxFI3hpVhn18IrIBrUtztj=w240-h480-rw">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #1a0b2e 0%, #3d2461 50%, #5e3a8e 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }
    .container { max-width: 1800px; margin: 0 auto; }
    .header {
      text-align: center;
      margin-bottom: 50px;
    }
    .kapruka-logo {
      width: 120px;
      height: 120px;
      margin: 0 auto 30px;
      border-radius: 50%;
      overflow: hidden;
      box-shadow: 0 15px 50px rgba(0,0,0,0.5);
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .kapruka-logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 48px;
      background: linear-gradient(135deg, #FFD700, #FFF, #FFD700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }
    .subtitle {
      color: rgba(255,255,255,0.8);
      font-size: 16px;
      letter-spacing: 3px;
      text-transform: uppercase;
    }
    .login-card {
      background: rgba(255,255,255,0.98);
      padding: 50px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 450px;
      margin: 0 auto;
    }
    .login-card h2 {
      font-family: 'Playfair Display', serif;
      color: #5e3a8e;
      font-size: 28px;
      margin-bottom: 30px;
      text-align: center;
    }
    .admin-content { display: none; }
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .tab-btn {
      padding: 15px 30px;
      background: rgba(255,255,255,0.2);
      color: white;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 12px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: all 0.3s;
    }
    .tab-btn:hover {
      background: rgba(255,215,0,0.2);
      border-color: #FFD700;
    }
    .tab-btn.active {
      background: linear-gradient(135deg, #5e3a8e, #3d2461);
      border-color: #FFD700;
      box-shadow: 0 8px 25px rgba(255,215,0,0.3);
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .card {
      background: rgba(255,255,255,0.98);
      padding: 35px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      margin-bottom: 30px;
    }
    .card h2 {
      font-family: 'Playfair Display', serif;
      color: #5e3a8e;
      font-size: 28px;
      margin-bottom: 20px;
    }
    .form-group { margin-bottom: 20px; }
    label {
      display: block;
      color: #5e3a8e;
      font-weight: 600;
      margin-bottom: 10px;
      font-size: 14px;
    }
    input, select, textarea {
      width: 100%;
      padding: 16px;
      border: 2px solid #e8e8e8;
      border-radius: 12px;
      font-size: 15px;
      font-family: 'Inter', sans-serif;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #FFD700;
    }
    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #5e3a8e, #3d2461);
      color: white;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(94,58,142,0.4);
    }
    .btn-warning {
      background: linear-gradient(135deg, #FFA726, #F57C00);
      color: white;
    }
    .btn-success {
      background: linear-gradient(135deg, #66BB6A, #43A047);
      color: white;
    }
    .btn-danger {
      background: linear-gradient(135deg, #EF5350, #E53935);
      color: white;
    }
    .btn-complete {
      background: linear-gradient(135deg, #9E9E9E, #757575);
      color: white;
    }
    .table-container {
      overflow-x: auto;
      margin-top: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
    }
    th {
      background: linear-gradient(135deg, #5e3a8e, #3d2461);
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    td {
      padding: 15px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 14px;
    }
    tr:hover {
      background: #f9f9f9;
    }
    .badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .badge-submitted { background: #E1BEE7; color: #4A148C; }
    .badge-working { background: #FFF9C4; color: #F57F17; }
    .badge-live { background: #C8E6C9; color: #1B5E20; }
    .badge-completed { background: #E0E0E0; color: #424242; }
    .badge-rejected { background: #FFCDD2; color: #C62828; }
    .badge-pending { background: #FFF9C4; color: #F57F17; }
    .badge-approved { background: #C8E6C9; color: #1B5E20; }
    .badge-warning { background: #FFE0B2; color: #E65100; }
    .action-btns {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .action-btns button {
      padding: 8px 15px;
      font-size: 12px;
    }
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid rgba(255,215,0,0.3);
      border-top-color: #FFD700;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 20px;
    }
    .modal-content {
      background: white;
      padding: 40px;
      border-radius: 24px;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    .modal h3 {
      font-family: 'Playfair Display', serif;
      color: #5e3a8e;
      font-size: 24px;
      margin-bottom: 20px;
    }
    .close-modal {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      font-size: 32px;
      cursor: pointer;
      color: #999;
      line-height: 1;
    }
    .close-modal:hover { color: #333; }
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .radio-label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 10px;
      border: 2px solid #e8e8e8;
      border-radius: 8px;
      transition: all 0.3s;
    }
    .radio-label:hover {
      border-color: #FFD700;
      background: #fffef0;
    }
    .radio-label input {
      width: auto;
      padding: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* STUDIO CALENDAR STYLES */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      padding: 20px;
      border-radius: 12px;
      text-align: center;
    }
    .stat-number {
      font-size: 36px;
      font-weight: 700;
      margin: 10px 0;
    }
    .stat-label {
      font-size: 13px;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 20px;
    }
    .month-nav {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .month-nav button {
      background: #5e3a8e;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    .month-nav h3 {
      font-size: 24px;
      color: #5e3a8e;
      min-width: 200px;
      text-align: center;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-top: 20px;
    }
    .calendar-day-header {
      background: #5e3a8e;
      color: white;
      padding: 10px;
      text-align: center;
      font-weight: 600;
      border-radius: 8px;
      font-size: 14px;
    }
    .calendar-day {
      background: white;
      border: 2px solid #e8e8e8;
      border-radius: 12px;
      min-height: 140px;
      padding: 8px;
      transition: all 0.3s;
      position: relative;
      overflow-y: auto;
      max-height: 300px;
    }
    .calendar-day:hover {
      border-color: #FFD700;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .calendar-day.empty {
      background: #f5f5f5;
      cursor: default;
      opacity: 0.6;
    }
    .calendar-day.empty:hover {
      box-shadow: none;
      border-color: #e8e8e8;
    }
    .day-number {
      font-weight: 700;
      color: #5e3a8e;
      font-size: 14px;
      margin-bottom: 6px;
    }

    @media (max-width: 768px) {
      h1 { font-size: 32px; }
      .tabs { flex-direction: column; }
      .tab-btn { width: 100%; }
      table { font-size: 12px; }
      th, td { padding: 10px; }
      .calendar-grid {
        grid-template-columns: 1fr;
      }
      .calendar-day {
        min-height: auto;
      }
    }
    .slot-item {
      padding: 16px;
      margin-bottom: 12px;
      border: 2px solid #e8e8e8;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      background: white;
    }
    .slot-item:hover {
      border-color: #5e3a8e;
      box-shadow: 0 4px 12px rgba(94,58,142,0.15);
      transform: translateX(5px);
    }
    .slot-item.selected {
      border-color: #FFD700;
      background: linear-gradient(135deg, #FFF9E6, #FFFEF0);
      box-shadow: 0 6px 20px rgba(255,215,0,0.3);
    }
    .slot-available {
      border-color: #4CAF50;
    }
    .slot-booked {
      background: #f5f5f5;
      cursor: not-allowed;
      opacity: 0.6;
    }
    .slot-booked:hover {
      transform: none;
      box-shadow: none;
    }
  </style>
</head>
<body>
  <div class="loading" id="loading"><div class="spinner"></div></div>
  <div class="modal" id="modal">
    <div class="modal-content" id="modalContent"></div>
  </div>

  <div class="container">
    <div class="header">
      <div class="kapruka-logo">
        <img src="https://play-lh.googleusercontent.com/XPaIW4RsTkd8au1rBlcwAtdyynz9pZyPVn3QPK4gXbboroWxFI3hpVhn18IrIBrUtztj=w240-h480-rw" alt="Kapruka">
      </div>
      <h1>Admin Dashboard</h1>
      <p class="subtitle">Campaign Management</p>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-card">
      <h2>ğŸ” Admin Login</h2>
      <form id="loginForm">
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="adminPassword" required placeholder="Enter admin password">
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;">Login</button>
      </form>
    </div>

    <!-- Admin Content -->
    <div id="adminContent" class="admin-content">
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('requests')">ğŸ“‹ Campaign Requests</button>
        <button class="tab-btn" onclick="switchTab('products')">ğŸ’¡ Product Suggestions</button>
        <button class="tab-btn" onclick="switchTab('content')">ğŸ“… Content Calendar</button>
        <button class="tab-btn" onclick="switchTab('studio')">ğŸ¬ Studio Calendar</button>
        <button class="tab-btn" onclick="switchTab('hotproducts')">ğŸ”¥ Hot Products</button>
        <button class="tab-btn" onclick="switchTab('departments')">ğŸ¢ Departments</button>
        <button class="tab-btn" style="margin-left:auto;background:#d32f2f;" onclick="logout()">Logout</button>
      </div>

      <!-- Campaign Requests Tab -->
      <div id="tab-requests" class="tab-content active">
        <div class="card">
          <h2>ğŸ“‹ Campaign Requests</h2>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Request ID</th>
                  <th>Date</th>
                  <th>Department</th>
                  <th>Month</th>
                  <th>Slot</th>
                  <th>Campaign</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="requestsTable">
                <tr><td colspan="8" style="text-align:center;padding:40px;">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Product Suggestions Tab -->
      <div id="tab-products" class="tab-content">
        <div class="card">
          <h2>ğŸ’¡ Product Suggestions</h2>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Submission ID</th>
                  <th>Date</th>
                  <th>Product Link</th>
                  <th>Category</th>
                  <th>Margin %</th>
                  <th>Status</th>
                  <th>Page Name</th>
                  <th>Slot Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="productsTable">
                <tr><td colspan="9" style="text-align:center;padding:40px;">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Content Calendar Tab -->
      <div id="tab-content" class="tab-content">
        <div class="card">
          <h2>ğŸ“… Add Content Theme</h2>
          <form id="themeForm">
            <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:20px;">
              <div class="form-group">
                <label>Theme Name</label>
                <input type="text" id="themeName" required placeholder="e.g., Valentine's Day">
              </div>
              <div class="form-group">
                <label>Slots Per Day</label>
                <input type="number" id="slotsPerDay" required placeholder="e.g., 3" min="1" max="10" value="3">
              </div>
            </div>
            <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:20px;">
              <div class="form-group">
                <label>Start Date</label>
                <input type="date" id="themeStart" required>
              </div>
              <div class="form-group">
                <label>End Date</label>
                <input type="date" id="themeEnd" required>
              </div>
            </div>
            <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:20px;">
              <div class="form-group">
                <label>Theme Color</label>
                <input type="color" id="themeColor" value="#422B73">
              </div>
              <div class="form-group">
                <label class="checkbox-label" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                  <input type="checkbox" id="isSeasonal" style="width:auto;">
                  <span>Seasonal Theme (no categories)</span>
                </label>
              </div>
            </div>
            <button type="submit" class="btn btn-primary">Add Theme</button>
          </form>
        </div>

        <div class="card">
          <h2>ğŸ—‚ï¸ Content Bookings</h2>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Slot</th>
                  <th>Category</th>
                  <th>Product Code</th>
                  <th>Status</th>
                  <th>Go Live</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="contentTable">
                <tr><td colspan="7" style="text-align:center;padding:40px;">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <h2>ğŸ¨ Themes</h2>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Theme</th>
                  <th>Start</th>
                  <th>End</th>
                  <th>Slots/Day</th>
                  <th>Type</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="themesTable">
                <tr><td colspan="6" style="text-align:center;padding:40px;">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- STUDIO CALENDAR TAB -->
      <div id="tab-studio" class="tab-content">
        <div class="card">
          <h2 style="margin-bottom:30px;">ğŸ¬ Studio Calendar</h2>

          <!-- DASHBOARD STATS -->
          <div class="stats-grid">
            <div class="stat-card" style="background:linear-gradient(135deg,#E8F5E9,#C8E6C9);">
              <div class="stat-label" style="color:#2E7D32;">Total Slots</div>
              <div class="stat-number" style="color:#1B5E20;" id="totalSlots">0</div>
            </div>
            <div class="stat-card" style="background:linear-gradient(135deg,#FFF3E0,#FFE0B2);">
              <div class="stat-label" style="color:#E65100;">Booked</div>
              <div class="stat-number" style="color:#BF360C;" id="bookedSlots">0</div>
            </div>
            <div class="stat-card" style="background:linear-gradient(135deg,#E3F2FD,#BBDEFB);">
              <div class="stat-label" style="color:#1565C0;">Empty</div>
              <div class="stat-number" style="color:#0D47A1;" id="emptySlots">0</div>
            </div>
            <div class="stat-card" style="background:linear-gradient(135deg,#C8E6C9,#A5D6A7);">
              <div class="stat-label" style="color:#2E7D32;">Completed</div>
              <div class="stat-number" style="color:#1B5E20;" id="completedSlots">0</div>
            </div>
            <div class="stat-card" style="background:linear-gradient(135deg,#E1BEE7,#CE93D8);">
              <div class="stat-label" style="color:#6A1B9A;">Completion Rate</div>
              <div class="stat-number" style="color:#4A148C;" id="completionRate">0%</div>
            </div>
          </div>

          <div class="calendar-header">
            <div class="month-nav">
              <button onclick="changeStudioMonth(-1)">â—€ Previous</button>
              <h3 id="studioMonthTitle">January 2026</h3>
              <button onclick="changeStudioMonth(1)">Next â–¶</button>
            </div>
            <button class="btn btn-success" onclick="openAddExtraContentModal()">â• Add Extra Content</button>
          </div>

          <div class="calendar-grid">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>
            <div id="studioCalendarGrid" style="grid-column:1/-1;display:grid;grid-template-columns:repeat(7,1fr);gap:8px;">
              <!-- Calendar days will be injected here -->
            </div>
          </div>
        </div>
      </div>

      <!-- HOT PRODUCTS TAB -->
      <div id="tab-hotproducts" class="tab-content">
        <div class="card">
          <h2>ğŸ”¥ Hot Products Management</h2>
          <p style="text-align:center;padding:40px;color:#999;">Hot Products section</p>
        </div>
      </div>

      <!-- DEPARTMENTS TAB -->
      <div id="tab-departments" class="tab-content">
        <div class="card">
          <h2>ğŸ¢ Departments</h2>
          <p style="text-align:center;padding:40px;color:#999;">Departments section</p>
        </div>
      </div>
    </div>
  </div>

  <script src="js/supabase-api.js"></script>
  <script>
    let isLoggedIn = false;
    let currentStudioMonth = new Date().getMonth() + 1;
    let currentStudioYear = new Date().getFullYear();
    let studioCalendarData = null;

    const ALL_PAGES = [
      'Kapruka FB Leads',
      'Electronic Factory',
      'Social Mart',
      'Fashion Factory',
      'Toys Factory',
      'Handbag Factory'
    ];

    function showLoading() {
      document.getElementById('loading').style.display = 'flex';
    }

    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
    }

    function showModal(content) {
      document.getElementById('modalContent').innerHTML = content;
      document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LOGIN
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const password = document.getElementById('adminPassword').value;

      if (verifyAdminPassword(password)) {
        isLoggedIn = true;
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('adminContent').style.display = 'block';
        loadAllData();
      } else {
        alert('Invalid password');
      }
    });

    function logout() {
      isLoggedIn = false;
      document.getElementById('loginScreen').style.display = 'block';
      document.getElementById('adminContent').style.display = 'none';
      document.getElementById('adminPassword').value = '';
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('tab-' + tab).classList.add('active');

      if (tab === 'content') {
        loadContentData();
      } else if (tab === 'studio') {
        loadStudioCalendar();
      } else if (tab === 'requests') {
        loadRequests();
      } else if (tab === 'products') {
        loadProducts();
      }
    }

    async function loadAllData() {
      loadRequests();
      loadProducts();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CAMPAIGN REQUESTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function loadRequests() {
      try {
        const requests = await getAllRequests();
        const tbody = document.getElementById('requestsTable');

        if (requests.length === 0) {
          tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:40px;">No requests yet</td></tr>';
          return;
        }

        tbody.innerHTML = requests.map(r => {
          let badgeClass = 'badge-submitted';
          if (r.status === 'Working') badgeClass = 'badge-working';
          if (r.status === 'Live') badgeClass = 'badge-live';
          if (r.status === 'Rejected') badgeClass = 'badge-rejected';
          if (r.status === 'Completed') badgeClass = 'badge-completed';

          return `
            <tr>
              <td><strong>${r.requestId}</strong></td>
              <td>${new Date(r.timestamp).toLocaleDateString()}</td>
              <td>${r.department}</td>
              <td>${r.month}</td>
              <td>${r.slot}</td>
              <td>${r.campaign}</td>
              <td><span class="badge ${badgeClass}">${r.status}</span></td>
              <td>
                <div class="action-btns">
                  <button class="btn btn-warning" onclick="updateStatus(${r.row}, 'Working')">Working</button>
                  <button class="btn btn-success" onclick="updateStatus(${r.row}, 'Live')">Live</button>
                  <button class="btn btn-complete" onclick="updateStatus(${r.row}, 'Completed')">Complete</button>
                  <button class="btn btn-danger" onclick="updateStatus(${r.row}, 'Rejected')">Reject</button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      } catch (error) {
        document.getElementById('requestsTable').innerHTML = 
          '<tr><td colspan="8" style="text-align:center;padding:40px;color:#d32f2f;">Error: ' + error.message + '</td></tr>';
      }
    }

    async function updateStatus(row, status) {
      const reviewer = prompt('Enter your name:');
      if (!reviewer) return;

      const comments = status === 'Rejected' ? prompt('Rejection reason (optional):') : '';

      try {
        showLoading();
        await updateRequestStatus(row, status, reviewer, comments || '');
        hideLoading();
        alert(`âœ… Status updated to: ${status}`);
        loadRequests();
      } catch (error) {
        hideLoading();
        alert('Error: ' + error.message);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PRODUCT SUGGESTIONS WITH SLOT SELECTION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    async function loadProducts() {
      try {
        const products = await getAllProductSuggestions();
        const tbody = document.getElementById('productsTable');

        if (products.length === 0) {
          tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:40px;">No products yet</td></tr>';
          return;
        }

        tbody.innerHTML = products.map(p => {
          let badgeClass = p.status === 'Approved' ? 'badge-approved' : 
                          p.status === 'Rejected' ? 'badge-rejected' : 'badge-pending';

          const actions = p.status === 'Approved' 
            ? `<span class="badge ${badgeClass}">${p.status}</span>`
            : `
              <div class="action-btns">
                <button class="btn btn-success" onclick="reviewProduct(${p.row}, 'Approved')">Approve</button>
                <button class="btn btn-danger" onclick="reviewProduct(${p.row}, 'Rejected')">Reject</button>
              </div>
            `;

          const slotInfo = p.slotDate && p.slotNumber 
            ? `${p.slotDate} (Slot ${p.slotNumber})` 
            : (p.goLiveDate || '-');

          return `
            <tr>
              <td><strong>${p.submissionId}</strong></td>
              <td>${new Date(p.timestamp).toLocaleDateString()}</td>
              <td><a href="${p.productLink}" target="_blank" style="color:#5e3a8e;">View</a></td>
              <td>${p.category}</td>
              <td>${p.margin}%</td>
              <td><span class="badge ${badgeClass}">${p.status}</span></td>
              <td>${p.assignedPage || '-'}</td>
              <td>${slotInfo}</td>
              <td>${actions}</td>
            </tr>
          `;
        }).join('');
      } catch (error) {
        document.getElementById('productsTable').innerHTML = 
          '<tr><td colspan="9" style="text-align:center;padding:40px;color:#d32f2f;">Error: ' + error.message + '</td></tr>';
      }
    }

    async function reviewProduct(row, status) {
      const reviewerName = prompt('Enter your name:');
      if (!reviewerName) return;

      if (status === 'Approved') {
        showApprovalModal(row, reviewerName);
      } else {
        const rejectionReason = prompt('Rejection Reason:');
        if (!rejectionReason) return;

        try {
          showLoading();
          await updateProductReview(row, {
            status: 'Rejected',
            reviewerName,
            rejectionReason
          });
          hideLoading();
          alert('Product rejected!');
          loadProducts();
        } catch (error) {
          hideLoading();
          alert('Error: ' + error.message);
        }
      }
    }

    async function showApprovalModal(row, reviewerName) {
      try {
        showLoading();
        
        const pageNames = getAllPageNames();
        
        const radioButtons = pageNames.map(page => {
          const schedule = page === 'Kapruka FB Leads' ? '(Monday - 3 slots)' :
                          page === 'Electronic Factory' ? '(Tuesday - 3 slots)' :
                          page === 'Social Mart' ? '(Wednesday - 3 slots)' :
                          page === 'Fashion Factory' ? '(Thursday - 3 slots)' :
                          page === 'Toys Factory' ? '(Friday - 3 slots)' :
                          page === 'Handbag Factory' ? '(Saturday - 3 slots)' : '';
          
          return `
            <label class="radio-label">
              <input type="radio" name="pageName" value="${page}" required onchange="loadPageSlots('${page}')">
              <span>${page} <small style="color:#999;">${schedule}</small></span>
            </label>
          `;
        }).join('');

        const content = `
          <button class="close-modal" onclick="closeModal()">Ã—</button>
          <h3>âœ… Approve Product</h3>
          <form id="approvalForm">
            <div class="form-group">
              <label>Select Page *</label>
              <div class="radio-group" style="max-height:300px;overflow-y:auto;">
                ${radioButtons}
              </div>
            </div>

            <div id="slotSelectionContainer" style="display:none;">
              <div class="form-group">
                <label>Select Available Slot (Next 3 Weeks) *</label>
                <div id="slotsDisplay" style="max-height:400px;overflow-y:auto;padding:15px;background:#f9f9f9;border-radius:12px;">
                  <p style="text-align:center;color:#999;">Select a page first</p>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label>Go Live Date *</label>
              <input type="date" id="goLiveDate" required>
            </div>

            <input type="hidden" id="selectedSlotDate">
            <input type="hidden" id="selectedSlotNumber">
            
            <button type="submit" class="btn btn-success" style="width:100%;margin-top:20px;">
              âœ… Approve & Assign Slot
            </button>
          </form>
        `;

        hideLoading();
        showModal(content);

        window.loadPageSlots = async function(pageName) {
          try {
            showLoading();
            const slotData = await getAvailableSlotsForPage(pageName);
            hideLoading();

            document.getElementById('slotSelectionContainer').style.display = 'block';
            
            const slotsHTML = `
              <h4 style="color:#5e3a8e;margin-bottom:15px;">
                ğŸ“… ${slotData.weekday} Slots (Next 3 Weeks)
              </h4>
              ${slotData.slots.map(slot => {
                const dateObj = new Date(slot.date);
                const formattedDate = dateObj.toLocaleDateString('en-US', { 
                  month: 'short', 
                  day: 'numeric', 
                  year: 'numeric' 
                });
                
                const slotClass = slot.available ? 'slot-available' : 'slot-booked';
                const slotIcon = slot.available ? 'â—‹' : 'â—';
                const slotStatus = slot.available ? 'Available' : `Booked: ${slot.bookedBy}`;

                return `
                  <div class="slot-item ${slotClass}" 
                       onclick="selectSlot('${slot.date}', ${slot.slotNumber}, ${slot.available})"
                       style="${!slot.available ? 'cursor:not-allowed;' : ''}">
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                      <div>
                        <strong style="color:#5e3a8e;">${formattedDate} - Slot ${slot.slotNumber}</strong>
                        <div style="font-size:12px;color:#666;margin-top:4px;">${slotStatus}</div>
                      </div>
                      <span style="font-size:24px;color:${slot.available ? '#4CAF50' : '#ccc'};">${slotIcon}</span>
                    </div>
                  </div>
                `;
              }).join('')}
            `;

            document.getElementById('slotsDisplay').innerHTML = slotsHTML;
          } catch (error) {
            hideLoading();
            alert('Error loading slots: ' + error.message);
          }
        };

        window.selectSlot = function(date, slotNumber, available) {
          if (!available) return;

          document.querySelectorAll('.slot-item').forEach(el => {
            el.classList.remove('selected');
          });

          event.currentTarget.classList.add('selected');

          document.getElementById('selectedSlotDate').value = date;
          document.getElementById('selectedSlotNumber').value = slotNumber;
          document.getElementById('goLiveDate').value = date;
        };

        document.getElementById('approvalForm').addEventListener('submit', async (e) => {
          e.preventDefault();

          const selectedPage = document.querySelector('input[name="pageName"]:checked');
          const slotDate = document.getElementById('selectedSlotDate').value;
          const slotNumber = document.getElementById('selectedSlotNumber').value;
          const goLiveDate = document.getElementById('goLiveDate').value;

          if (!selectedPage) {
            alert('Please select a page');
            return;
          }

          if (!slotDate || !slotNumber) {
            alert('Please select an available slot');
            return;
          }

          try {
            showLoading();
            await updateProductReviewWithSlot(row, {
              status: 'Approved',
              reviewerName: reviewerName,
              assignedPage: selectedPage.value,
              goLiveDate: goLiveDate,
              slotDate: slotDate,
              slotNumber: parseInt(slotNumber)
            });

            hideLoading();
            closeModal();
            alert(`âœ… Product approved!\n\nPage: ${selectedPage.value}\nSlot: ${slotDate} - Slot ${slotNumber}\nGo Live: ${goLiveDate}`);
            loadProducts();
          } catch (error) {
            hideLoading();
            alert('Error: ' + error.message);
          }
        });

      } catch (error) {
        hideLoading();
        alert('Error: ' + error.message);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONTENT CALENDAR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function loadContentData() {
      try {
        const bookings = await getAllContentBookings();
        const tbody = document.getElementById('contentTable');

        if (bookings.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:40px;">No content bookings yet</td></tr>';
        } else {
          tbody.innerHTML = bookings.slice(0, 50).map(b => {
            let badgeClass = b.status === 'Approved' ? 'badge-approved' : 
                            b.status === 'Rejected' ? 'badge-rejected' : 'badge-pending';
            return `
              <tr>
                <td>${b.date}</td>
                <td>${b.slotNumber}</td>
                <td>${b.category}</td>
                <td><strong>${b.productCode}</strong></td>
                <td><span class="badge ${badgeClass}">${b.status}</span></td>
                <td>${b.goLiveDate || '-'}</td>
                <td>-</td>
              </tr>
            `;
          }).join('');
        }

        const themes = await getAllThemes();
        const themesBody = document.getElementById('themesTable');
        
        if (themes.length === 0) {
          themesBody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;">No themes yet</td></tr>';
        } else {
          themesBody.innerHTML = themes.map(t => `
            <tr>
              <td><strong>${t.theme_name}</strong></td>
              <td>${t.start_date}</td>
              <td>${t.end_date}</td>
              <td>${t.slots_per_day}</td>
              <td>${t.is_seasonal ? 'ğŸŒŸ Seasonal' : 'ğŸ“… Regular'}</td>
              <td>
                <button class="btn btn-danger" onclick="deleteThemeFunc(${t.id})">Delete</button>
              </td>
            </tr>
          `).join('');
        }
      } catch (error) {
        console.error('Content Calendar Error:', error);
      }
    }

    document.getElementById('themeForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      try {
        showLoading();
        await addTheme({
          themeName: document.getElementById('themeName').value,
          startDate: document.getElementById('themeStart').value,
          endDate: document.getElementById('themeEnd').value,
          slotsPerDay: document.getElementById('slotsPerDay').value,
          themeColor: document.getElementById('themeColor').value,
          isSeasonal: document.getElementById('isSeasonal').checked
        });
        hideLoading();
        alert('âœ… Theme added successfully!');
        document.getElementById('themeForm').reset();
        loadContentData();
      } catch (error) {
        hideLoading();
        alert('Error: ' + error.message);
      }
    });

    async function deleteThemeFunc(id) {
      if (!confirm('Delete this theme?')) return;
      try {
        showLoading();
        await deleteTheme(id);
        hideLoading();
        alert('âœ… Theme deleted!');
        loadContentData();
      } catch (error) {
        hideLoading();
        alert('Error: ' + error.message);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STUDIO CALENDAR - ALL 6 PAGES SHOW ON EVERY DAY
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    async function loadStudioCalendar() {
      try {
        showLoading();
        
        studioCalendarData = await getStudioCalendarData(currentStudioMonth, currentStudioYear);
        console.log('Studio Calendar Data:', studioCalendarData);

        const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
        document.getElementById('studioMonthTitle').textContent = `${months[currentStudioMonth - 1]} ${currentStudioYear}`;

        renderStudioCalendar();
        updateStudioStats();
        
        hideLoading();
      } catch (error) {
        hideLoading();
        console.error('Studio Calendar Error:', error);
        alert('Error loading studio calendar: ' + error.message);
      }
    }

    function updateStudioStats() {
      if (!studioCalendarData) return;

      const totalSlots = studioCalendarData.calendarItems.length;
      const bookedSlots = studioCalendarData.calendarItems.filter(item => item.status === 'booked').length;
      const emptySlots = studioCalendarData.calendarItems.filter(item => item.status === 'empty').length;
      const completedSlots = studioCalendarData.calendarItems.filter(item => item.studioStatus === 'completed').length;
      const completionRate = bookedSlots > 0 ? Math.round((completedSlots / bookedSlots) * 100) : 0;

      document.getElementById('totalSlots').textContent = totalSlots;
      document.getElementById('bookedSlots').textContent = bookedSlots;
      document.getElementById('emptySlots').textContent = emptySlots;
      document.getElementById('completedSlots').textContent = completedSlots;
      document.getElementById('completionRate').textContent = completionRate + '%';
    }

    function renderStudioCalendar() {
      const grid = document.getElementById('studioCalendarGrid');
      grid.innerHTML = '';

      const firstDay = new Date(currentStudioYear, currentStudioMonth - 1, 1).getDay();
      const totalDays = new Date(currentStudioYear, currentStudioMonth, 0).getDate();

      // Empty cells before first day
      for (let i = 0; i < firstDay; i++) {
        const cell = document.createElement('div');
        cell.className = 'calendar-day empty';
        grid.appendChild(cell);
      }

      // Group calendar items by date
      const itemsByDate = {};
      if (studioCalendarData && studioCalendarData.calendarItems) {
        studioCalendarData.calendarItems.forEach(item => {
          if (!itemsByDate[item.date]) {
            itemsByDate[item.date] = [];
          }
          itemsByDate[item.date].push(item);
        });
      }

      // Group themes by date range
      const themesByDate = {};
      if (studioCalendarData && studioCalendarData.themes) {
        studioCalendarData.themes.forEach(theme => {
          const start = new Date(theme.start_date);
          const end = new Date(theme.end_date);
          
          for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
            const dateStr = d.toISOString().split('T')[0];
            if (!themesByDate[dateStr]) {
              themesByDate[dateStr] = [];
            }
            themesByDate[dateStr].push(theme);
          }
        });
      }

      // Create day cells
      for (let day = 1; day <= totalDays; day++) {
        const dateStr = `${currentStudioYear}-${String(currentStudioMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayOfWeek = new Date(dateStr).getDay();
        const dayItems = itemsByDate[dateStr] || [];
        const dayThemes = themesByDate[dateStr] || [];
        
        const cell = createStudioDayCell(day, dateStr, dayItems, dayThemes, dayOfWeek);
        grid.appendChild(cell);
      }
    }

    function createStudioDayCell(day, dateStr, dayItems, dayThemes, dayOfWeek) {
      const cell = document.createElement('div');
      cell.className = 'calendar-day';

      // Day number
      const dayNumberDiv = document.createElement('div');
      dayNumberDiv.className = 'day-number';
      dayNumberDiv.textContent = day;
      cell.appendChild(dayNumberDiv);

      // Show themes if any
      if (dayThemes.length > 0) {
        const themeDiv = document.createElement('div');
        themeDiv.style.cssText = 'font-size:8px;color:#666;margin-bottom:5px;font-weight:600;padding:2px 4px;background:#f0f0f0;border-radius:3px;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;';
        themeDiv.textContent = dayThemes.map(t => t.theme_name).join(' + ');
        themeDiv.title = dayThemes.map(t => t.theme_name).join(', ');
        cell.appendChild(themeDiv);

        // Apply theme color
        const theme = dayThemes[0];
        if (theme.theme_color) {
          cell.style.borderColor = theme.theme_color;
          cell.style.background = `linear-gradient(135deg, ${theme.theme_color}11, ${theme.theme_color}05)`;
        }
      }

      // Group items by page
      const itemsByPage = {};
      dayItems.forEach(item => {
        const pageName = item.pageName || (item.type === 'tiktok_slot' ? 'TikTok Video' : 'Unknown');
        if (!itemsByPage[pageName]) {
          itemsByPage[pageName] = [];
        }
        itemsByPage[pageName].push(item);
      });

      // Show all 6 pages for weekdays (Mon-Sat), TikTok for Sunday
      const allPages = dayOfWeek === 0 
        ? ['TikTok Video'] 
        : ALL_PAGES;

      allPages.forEach(pageName => {
        const pageItems = itemsByPage[pageName] || [];
        const slotsForPage = pageName === 'TikTok Video' ? 1 : 3;

        // Page header (small and clean)
        const pageDiv = document.createElement('div');
        pageDiv.style.cssText = 'font-size:8px;color:#5e3a8e;margin:5px 0 3px 0;font-weight:700;padding:2px 4px;background:rgba(94,58,142,0.08);border-radius:3px;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;';
        pageDiv.textContent = `ğŸ“± ${pageName}`;
        pageDiv.title = pageName;
        cell.appendChild(pageDiv);

        // Show slots for this page
        for (let slotNum = 1; slotNum <= slotsForPage; slotNum++) {
          const slotItem = pageItems.find(item => item.slotNumber === slotNum);
          
          const slotDiv = document.createElement('div');
          slotDiv.style.cssText = 'font-size:8px;padding:3px 4px;margin-bottom:2px;border-radius:3px;cursor:pointer;border-left:2px solid transparent;';
          
          if (slotItem) {
            if (slotItem.status === 'booked') {
              slotDiv.style.background = '#C8E6C9';
              slotDiv.style.borderLeft = '2px solid #43A047';
              slotDiv.innerHTML = `<strong>S${slotNum}</strong> <span style="color:#2E7D32;">â—</span>`;
              slotDiv.title = `Slot ${slotNum}: ${slotItem.category || 'Booked'} - ${slotItem.productCode || 'N/A'}`;
            } else if (slotItem.status === 'pending') {
              slotDiv.style.background = '#FFE0B2';
              slotDiv.style.borderLeft = '2px solid #FB8C00';
              slotDiv.innerHTML = `<strong>S${slotNum}</strong> <span style="color:#F57C00;">â—</span>`;
              slotDiv.title = `Slot ${slotNum}: Pending - ${slotItem.category || 'N/A'}`;
            } else if (slotItem.status === 'empty') {
              slotDiv.style.background = '#FFF9C4';
              slotDiv.style.borderLeft = '2px solid #F57C00';
              slotDiv.innerHTML = `<strong>S${slotNum}</strong> <span style="color:#F57C00;">â—‹</span>`;
              slotDiv.title = `Slot ${slotNum}: Empty - ${slotItem.category || 'Any'}`;
            }

            slotDiv.onclick = (e) => {
              e.stopPropagation();
              showContentDetails(slotItem, dateStr, { page: pageName, slots: slotsForPage });
            };
          } else {
            // No content calendar entry - show as empty
            slotDiv.style.background = '#f5f5f5';
            slotDiv.style.borderLeft = '2px solid #ccc';
            slotDiv.innerHTML = `<strong>S${slotNum}</strong> <span style="color:#999;">â—‹</span>`;
            slotDiv.title = `Slot ${slotNum}: No Content`;
          }

          cell.appendChild(slotDiv);
        }
      });

      return cell;
    }

    function showContentDetails(item, date, pageConfig) {
      const dateObj = new Date(date);
      const formattedDate = dateObj.toLocaleDateString('en-US', { 
        weekday: 'long', 
        month: 'long', 
        day: 'numeric', 
        year: 'numeric' 
      });

      let detailsHTML = `
        <button class="close-modal" onclick="closeModal()">Ã—</button>
        <h3>ğŸ“‹ Content Slot Details</h3>
        <div style="background:linear-gradient(135deg,#E8F5E9,#C8E6C9);padding:15px;border-radius:12px;margin-bottom:20px;text-align:center;">
          <div style="font-size:18px;font-weight:700;color:#1B5E20;">${formattedDate}</div>
          ${pageConfig ? `<div style="font-size:14px;color:#2E7D32;margin-top:5px;">ğŸ“± ${pageConfig.page}</div>` : ''}
        </div>
        <div style="background:#f9f9f9;padding:20px;border-radius:12px;margin-bottom:20px;">
          <div style="margin-bottom:15px;">
            <strong style="color:#5e3a8e;">Slot Number:</strong><br>
            Slot ${item.slotNumber || 'N/A'}
          </div>
          <div style="margin-bottom:15px;">
            <strong style="color:#5e3a8e;">Category:</strong><br>
            ${item.category || item.type || 'N/A'}
          </div>
          <div style="margin-bottom:15px;">
            <strong style="color:#5e3a8e;">Status:</strong><br>
            <span class="badge badge-${item.status === 'booked' ? 'approved' : item.status === 'empty' ? 'warning' : 'pending'}">
              ${item.status.toUpperCase()}
            </span>
          </div>
          ${item.productCode ? `
            <div style="margin-bottom:15px;">
              <strong style="color:#5e3a8e;">Product Code:</strong><br>
              ${item.productCode}
            </div>
          ` : ''}
          ${item.productLink ? `
            <div style="margin-bottom:15px;">
              <strong style="color:#5e3a8e;">Product Link:</strong><br>
              <a href="${item.productLink}" target="_blank" style="color:#5e3a8e;">View Product â†’</a>
            </div>
          ` : ''}
          ${item.theme ? `
            <div style="margin-bottom:15px;">
              <strong style="color:#5e3a8e;">Theme:</strong><br>
              ${item.theme}
            </div>
          ` : ''}
          ${item.submittedBy ? `
            <div style="margin-bottom:15px;">
              <strong style="color:#5e3a8e;">Submitted By:</strong><br>
              ${item.submittedBy}
            </div>
          ` : ''}
          ${item.promotionIdea ? `
            <div style="margin-bottom:15px;">
              <strong style="color:#5e3a8e;">Promotion Idea:</strong><br>
              ${item.promotionIdea}
            </div>
          ` : ''}
          <div style="margin-bottom:15px;">
            <strong style="color:#5e3a8e;">Studio Status:</strong><br>
            <span class="badge badge-${item.studioStatus === 'completed' ? 'approved' : 'pending'}">
              ${item.studioStatus ? item.studioStatus.toUpperCase() : 'PENDING'}
            </span>
          </div>
          ${item.studioLink ? `
            <div style="margin-bottom:15px;">
              <strong style="color:#5e3a8e;">Content Link:</strong><br>
              <a href="${item.studioLink}" target="_blank" style="color:#5e3a8e;">View Content â†’</a>
            </div>
          ` : ''}
        </div>
      `;

      if (item.studioId && item.status === 'booked') {
        detailsHTML += `
          <div style="margin-top:20px;">
            <h4 style="color:#5e3a8e;margin-bottom:15px;">âœ… Mark as Completed</h4>
            <div class="form-group">
              <label>Content Link (Drive/Cloud)</label>
              <input type="url" id="contentLinkInput" placeholder="https://drive.google.com/..." style="width:100%;">
            </div>
            <button class="btn btn-success" onclick="markStudioComplete(${item.studioId})" style="width:100%;">
              âœ“ Mark as Completed
            </button>
          </div>
        `;
      } else if (item.status === 'empty') {
        detailsHTML += `
          <div style="background:#FFF3E0;padding:15px;border-radius:12px;border-left:4px solid #F57C00;">
            <strong style="color:#E65100;">ğŸ“Œ Note:</strong><br>
            <div style="color:#666;margin-top:8px;">This slot is empty. Content team should create content for this slot based on the ${item.category || 'assigned category'}.</div>
          </div>
        `;
      }

      showModal(detailsHTML);
    }

    async function markStudioComplete(studioId) {
      const contentLink = document.getElementById('contentLinkInput').value;
      if (!contentLink) {
        alert('Please enter content link');
        return;
      }

      try {
        showLoading();
        await updateStudioCompletion(studioId, {
          completion_status: 'completed',
          content_link: contentLink
        });
        hideLoading();
        closeModal();
        alert('âœ… Marked as completed!');
        loadStudioCalendar();
      } catch (error) {
        hideLoading();
        alert('Error: ' + error.message);
      }
    }

    function changeStudioMonth(delta) {
      currentStudioMonth += delta;
      if (currentStudioMonth > 12) {
        currentStudioMonth = 1;
        currentStudioYear++;
      } else if (currentStudioMonth < 1) {
        currentStudioMonth = 12;
        currentStudioYear--;
      }
      loadStudioCalendar();
    }

    function openAddExtraContentModal() {
      alert('Add extra content feature (coming soon)');
    }
  </script>
</body>
</html>
